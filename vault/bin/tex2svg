#!/bin/bash 

while getopts "qnkj:" option ; do 
  case $option in 
    q) type="question" ;; 
    n) type="snippet" ;;
    k) type="skill" ;;
    j) id=$OPTARG ;;
    \?) exit 1 ;;
  esac
done 

# Get the last argument = TeX filename 
shift $((OPTIND-1))
tex_file=$(readlink -e $1)

if [ -z "$id" ] ; then 
	# If TeX file is named as [\d]+.tex, then perhaps the basename is the ID 
	id=$(basename $1 | cut -d'.' -f1)
fi

# Determine the target folder in vault/ 

if [ "$type" == "question" ] ; then 
  target=$(find $VAULT/q/ -maxdepth 2 -name $id) 
elif [ "$type" == "snippet" ] ; then 
  target=$(find $VAULT/snippets/ -maxdepth 1 -name $id)
elif [ "$type" == "skill" ] ; then 
  target=$(find $VAULT/skills/ -maxdepth 1 -name $id)
fi 

if [ -z "$target" ] ; then 
  echo "[Error]: Target folder not found!" 
  cd - 
  exit 1
fi 

# Copy tex_file to target folder and call 'make xmlforquill' 
# That will take care of switching preview off and adding source.tex to Git

cp $tex_file $target/source.tex
make -C $target xmlforquill
