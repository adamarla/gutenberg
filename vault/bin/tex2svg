#!/bin/bash 

while getopts "q:n:k:" option ; do 
  case $option in 
    q) q_id=$OPTARG ;; 
    n) snippet_id=$OPTARG ;;
    k) skill_id=$OPTARG ;;
    \?) exit 1 ;;
  esac
done 

# Get the last argument = TeX filename 
shift $((OPTIND-1))
tex_file=$(readlink -e $1)

# Determine the target folder in vault/ 

if [ -n "$q_id" ] ; then 
  target=$(find $VAULT/q/ -maxdepth 2 -name $q_id) 
elif [ -n "$snippet_id" ] ; then 
  target=$(find $VAULT/snippets/ -maxdepth 1 -name $snippet_id)
elif [ -n "$skill_id" ] ; then 
  target=$(find $VAULT/skills/ -maxdepth 1 -name $skill_id)
fi 

if [ -z "$target" ] ; then 
  echo "[Error]: Target folder not found!" 
  cd - 
  exit 1
fi 

# Copy tex_file to target folder and call 'make tex2svg' 
# That will take care of switching preview off and adding source.tex to Git

cp $tex_file $target/source.tex
make -C $target tex2svg
