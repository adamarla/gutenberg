#!/bin/bash 

fname=$(basename $1 | cut -d'.' -f1)
author=$(pdfinfo $1 | grep Creator | sed -e "s/Creator:[[:space:]]*//g")

# author = TeX if generated by pdflatex OR dvipdf OR ps2pdf 

if [[ $author == "TeX" || $author =~ ^dvips ]] ; then 
  # Output: tex-%d.svg 

  echo "TeX" 
  pdf2svg $1 $fname-%d.svg all 
  for f in `ls $fname*.svg` ; do 
    n=$(basename $f | cut -d'.' -f1 | cut -d'-' -f2)
    svgclip.py -o tex-$n.svg $f 
    rm -f $f 
  done 
else
  # Output: prefab-%d.svg 

  pdftoppm $1 p 

  for f in `ls *.ppm` ; do 
    n=$(basename $f | cut -d'.' -f1 | cut -d'-' -f2)
    pamcut -left 5 -top 5 $f > prefab-$n.ppm 
    potrace -s --tight --group -r 300 prefab-$n.ppm 
    rm -f $f prefab-$n.ppm 
  done 
fi 


