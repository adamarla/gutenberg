#!/bin/bash 

if [[ $1 ]] ; then 
  case $1 in 
    -r) server=http://www.gradians.com ;;
    *) server=http://localhost:3000 ;;
  esac 
else 
  server=http://localhost:3000
fi 

path=$(pwd | rev | cut -d'/' -f1-3 | rev)
cid=$(grep -oP 'chapterId="\K[^"]*' source.xml)

if [ -z "$cid" ] ; then 
  ping="$server/sku/recompiled?path=$path"
else 
  ping="$server/sku/recompiled?path=$path&c=$cid"
fi 

curl $ping
